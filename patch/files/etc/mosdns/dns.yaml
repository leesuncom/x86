plugins:
  ################ DNS #################
  # google doh dot h3（备注：国内无代理时大概率超时，可酌情注释）
  - tag: google
    type: forward
    args:
      concurrent: 3
      upstreams:
        - addr: "https://dns.google/dns-query"
          dial_addr: "8.8.4.4"
        - addr: "https://dns.google/dns-query"
          dial_addr: "8.8.8.8"
        - addr: "tls://dns.google"
          dial_addr: "8.8.4.4"

        - addr: "tls://dns.google"
          dial_addr: "8.8.8.8"
          enable_pipeline: true
        # h3（国内无代理大概率不可用）
        - addr: "https://dns.google/dns-query"
          dial_addr: "8.8.4.4"
          enable_http3: true
        - addr: "https://dns.google/dns-query"
          dial_addr: "8.8.8.8"
          enable_http3: true

  # cloudflare doh dot h3
  - tag: cloudflare
    type: forward
    args:
      concurrent: 3
      upstreams:
        - addr: "tls://1.1.1.1"
          dial_addr: "1.1.1.1"

  - tag: nextdns
    type: forward
    args:
      concurrent: 2
      upstreams:
        - addr: "https://dns.nextdns.io"
          dial_addr: "45.90.28.186"
          enable_http3: true
        - addr: "tls://dns.nextdns.io"
          enable_pipeline: true
          dial_addr: "45.90.28.186"

  - tag: quad9
    type: forward
    args:
      concurrent: 2
      upstreams:
        - addr: "https://dns11.quad9.net/dns-query"
          dial_addr: "9.9.9.11"
        - addr: "tls://dns11.quad9.net"
          dial_addr: "9.9.9.11"
          enable_pipeline: true

  - tag: forward_remote
    type: forward
    args:
      concurrent: 1
      upstreams:
        - addr: "https://127.0.0.1:7058/dns-query"

  - tag: dnscrypt-proxy2
    type: forward
    args:
      concurrent: 1
      upstreams:
        - addr: "https://127.0.0.1:7058/dns-query"

  # ali doh dot h3（国内首选，稳定高效）
  - tag: ali
    type: forward
    args:
      concurrent: 3
      upstreams:
        - addr: "https://dns.alidns.com/dns-query"
          dial_addr: "223.6.6.6"
        - addr: "tls://dns.alidns.com"
          dial_addr: "223.5.5.5"
          enable_pipeline: true
        - addr: "https://dns.alidns.com/dns-query"
          dial_addr: "223.5.5.5"
          enable_http3: true

  # dnspod doh dot（国内备用，稳定可靠）
  - tag: dnspod
    type: forward
    args:
      concurrent: 3
      upstreams:
        - addr: "https://doh.pub/dns-query"
          dial_addr: "1.12.12.12"
        - addr: "https://doh.pub/dns-query"
          dial_addr: "120.53.53.53"
        - addr: "tls://dot.pub"
          dial_addr: "1.12.12.12"
          enable_pipeline: true
        - addr: "tls://dot.pub"
          dial_addr: "120.53.53.53"
          enable_pipeline: true

  # local dns
  - tag: local
    type: forward
    args:
      concurrent: 1
      upstreams:
        - addr: "udp://127.0.0.1:53"

  # server 失败
  - tag: reject_2
    type: sequence
    args:
      - exec: reject 2

  # 拒绝响应
  - tag: reject_3
    type: sequence
    args:
      - exec: reject 3

  # 不支持的操作
  - tag: reject_5
    type: sequence
    args:
      - exec: reject 5